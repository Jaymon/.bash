#!/usr/bin/env bash
# -*- mode: sh -*-
# vi: set ft=sh :
###############################################################################
#
#? hist <cmd|n> -> get rows in history matching cmd, or last n rows
#
# https://unix.stackexchange.com/questions/112354/history-stops-working-when-run-inside-bash-script
#
###############################################################################

if [[ $1 == "--help" ]] || [[ $1 == "-h" ]]; then

    echo "usage: $(basename $0) [CMD|N]"
    echo "get rows in history matching cmd, or last n rows"
    exit 0

fi

history_file=~/.bash_history
if [[ -n $HISTFILE ]]; then
    history_file=$HISTFILE
fi


# since 3-14-12 this combined with histl (created 3-10-12)

# set -x

if [[ "$#" -eq 0 ]]; then

    echo "history | tail -n 25"
    cat $history_file | tail -n 25

elif [[ $(is_int $1; echo $?) -eq 0 ]]; then

    echo "history | tail -n $1"
    cat $history_file | tail -n $1

else

    echo "history | grep -i $1"
    cat $history_file | grep -i $1

fi

# set +x

